var app=angular.module("app",[]).directive("fileModel",["$parse",function(e){return{restrict:"A",link:function(t,i,n){var o=e(n.fileModel).assign;i.bind("change",function(){t.$apply(function(){o(t,i[0].files[0])})})}}}]).service("giphyQuery",["$http","$q",function(e,t){var i=this;return i.get=function(i){var n=t.defer();return e.get(i).then(function(e){n.resolve(e)},function(e){n.reject(e)}),n.promise},i.post=function(i){var n=t.defer();return e.post("//upload.giphy.com/v1/gifs",i,{transformRequest:angular.indentity,headers:{"Content-Type":void 0}}).then(function(e){n.resolve(e)},function(e){n.reject(e)}),n.promise},i}]).controller("giphyCtrl",["$scope","$http","$window","giphyQuery",function(e,t,i,n){e.col=4,e.myCollectionCol=2,e.uploadActive=!1,e.user={userName:"",userLogin:"",login:function(t){e.user.userName=t,e.myCollection.load(e.user.userName)}},angular.element(i).bind("scroll",function(){var t="innerHeight"in window?window.innerHeight:document.documentElement.offsetHeight,i=document.body,n=document.documentElement,o=Math.max(i.scrollHeight,i.offsetHeight,n.clientHeight,n.scrollHeight,n.offsetHeight);windowBottom=t+window.pageYOffset,windowBottom>=o&&(e.giphy.inProgress||e.images.getDataWithOffset())}),e.getCol=function(e){return new Array(e)},e.getImageStyle=function(e,t){var i=["rgb(85, 211, 176)","rgb(81, 171, 176)","rgb(88, 226, 134)","rgb(163, 189, 242)","rgb(135, 178, 194)","rgb(235, 226, 119)","rgb(183, 231, 119)"];return{width:e.width+"px",height:e.height+"px","background-color":i[t%i.length]}},e.giphy={src:"//api.giphy.com/v1/gifs/search?q=",api_key:"dc6zaTOxFJmzC",offset:25,currentOffset:25,inProgress:!1,isUserSearch:!1,uploadData:{file:"",api_key:"dc6zaTOxFJmzC",tags:""},search:function(){var t=e.searchField.replace(/\s/g,"+");return this.src+t+"&api_key="+e.giphy.api_key},getByIds:function(t){return"http://api.giphy.com/v1/gifs?api_key="+e.giphy.api_key+"&ids="+t.join(",")},getById:function(t){return"http://api.giphy.com/v1/gifs/"+t+"?api_key="+e.giphy.api_key},getWithOffset:function(){if(e.giphy.isUserSearch){var t=e.searchField.replace(/\s/g,"+");return this.src+t+"&api_key="+e.giphy.api_key+"&offset="+e.giphy.currentOffset}return"//api.giphy.com/v1/gifs/trending?api_key="+e.giphy.api_key+"&offset="+e.giphy.currentOffset},upload:function(){var t=new FormData;for(var i in e.giphy.uploadData)t.append(i,e.giphy.uploadData[i]);return t}},e.images={data:[],currentImage:"",modal:!1,getData:function(){n.get("//api.giphy.com/v1/gifs/trending?api_key=dc6zaTOxFJmzC&limit=25").then(function(t){e.images.data=t.data.data},function(e){console.log(e)})},getSearchData:function(){n.get(e.giphy.search()).then(function(t){e.images.data=t.data.data},function(e){console.log(e)})},getDataWithOffset:function(){e.giphy.inProgress=!0,n.get(e.giphy.getWithOffset()).then(function(t){e.images.data=e.images.data.concat(t.data.data),e.giphy.currentOffset+=e.giphy.offset,e.giphy.inProgress=!1},function(e){console.log(e)})},show:function(t){e.images.currentImage=t.images.original.url,e.images.modal=!0}},e.myCollection={data:[],imageData:[],load:function(t){localStorage.getItem(t)&&(e.myCollection.data=JSON.parse(localStorage.getItem(t)),n.get(e.giphy.getByIds(e.myCollection.data)).then(function(t){e.myCollection.imageData=t.data.data},function(e){console.log(e)}))},add:function(t){-1==e.myCollection.data.indexOf(t.id)&&(e.myCollection.data.push(t.id),localStorage.setItem(e.user.userName,JSON.stringify(e.myCollection.data)),n.get(e.giphy.getById(t.id)).then(function(t){e.myCollection.imageData.push(t.data.data)},function(e){console.log(e)}))},remove:function(t){e.myCollection.data.splice(t,1),e.myCollection.imageData.splice(t,1),localStorage.setItem(e.user.userName,JSON.stringify(e.myCollection.data))},upload:function(){n.post(e.giphy.upload()).then(function(t){200==t.data.meta.status?(e.myCollection.add(t.data.data),e.uploadActive=!1):alert("wrong file type!")},function(e){console.log(e)})}},e.images.getData(),window.innerWidth>995&&(e.col=4),window.innerWidth<=995&&(e.col=3),window.innerWidth<=735&&(e.col=2),window.innerWidth<=500&&(e.col=1),$(window).resize(function(){e.$apply(function(){window.innerWidth>995&&(e.col=4),window.innerWidth<=995&&(e.col=3),window.innerWidth<=735&&(e.col=2),window.innerWidth<=500&&(e.col=1)})})}]);